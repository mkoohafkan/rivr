<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Flood wave routing — route_wave • rivr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Flood wave routing — route_wave"><meta property="og:description" content="Route a flood wave down a prismatic channel."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rivr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2-3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/publication-reproduction.html">Reproducing the R Journal Publication</a>
    </li>
    <li>
      <a href="../articles/quickstart.html">Quickstart with rivr</a>
    </li>
    <li>
      <a href="../articles/technical-vignette.html">Derivations used in rivr</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mkoohafkan/rivr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Flood wave routing</h1>
    <small class="dont-index">Source: <a href="https://github.com/mkoohafkan/rivr/blob/HEAD/R/route_wave_v4.r" class="external-link"><code>R/route_wave_v4.r</code></a></small>
    <div class="hidden name"><code>route_wave.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Route a flood wave down a prismatic channel.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">route_wave</span><span class="op">(</span></span>
<span>  <span class="va">So</span>,</span>
<span>  <span class="va">n</span>,</span>
<span>  <span class="va">Cm</span>,</span>
<span>  <span class="va">g</span>,</span>
<span>  <span class="va">B</span>,</span>
<span>  <span class="va">SS</span>,</span>
<span>  <span class="va">initial.condition</span>,</span>
<span>  <span class="va">boundary.condition</span>,</span>
<span>  <span class="va">downstream.condition</span>,</span>
<span>  <span class="va">timestep</span>,</span>
<span>  <span class="va">spacestep</span>,</span>
<span>  <span class="va">numnodes</span>,</span>
<span>  <span class="va">monitor.nodes</span>,</span>
<span>  <span class="va">monitor.times</span>,</span>
<span>  engine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Dynamic"</span>, <span class="st">"Kinematic"</span><span class="op">)</span>,</span>
<span>  scheme <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MacCormack"</span>, <span class="st">"Lax"</span><span class="op">)</span>,</span>
<span>  boundary.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"QQ"</span>, <span class="st">"Qy"</span>, <span class="st">"yQ"</span>, <span class="st">"yy"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>So</dt>
<dd><p>Channel slope [\(L L^{-1}\)].</p></dd>


<dt>n</dt>
<dd><p>Manning's roughness coefficient.</p></dd>


<dt>Cm</dt>
<dd><p>Unit conversion coefficient for Manning's equation. For SI units, Cm = 1.</p></dd>


<dt>g</dt>
<dd><p>Gravitational acceleration [\(L T^{-2}\)].</p></dd>


<dt>B</dt>
<dd><p>Channel bottom width [\(L\)].</p></dd>


<dt>SS</dt>
<dd><p>Channel sideslope [\(L L^{-1}\)].</p></dd>


<dt>initial.condition</dt>
<dd><p>The initial flow rate [\(L^3 T^{-1}\)], assumed constant 
throughout the channel.</p></dd>


<dt>boundary.condition</dt>
<dd><p>Vector specifying the upstream boundary condition 
for the full duration of the model. If <code>engine = "Kinematic"</code>, values are 
assumed to be flow [\(L^3 T^{-1}\)]. If <code>engine = "Dynamic"</code>, the form of the 
boundary condition is determined by the argument <code>boundary.type</code>.</p></dd>


<dt>downstream.condition</dt>
<dd><p>Only used if <code>engine = "Dynamic"</code>. Vector specifying 
the upstream boundary condition for the full duration of the model. Must be the same
length as <code>boundary.condition</code>.</p></dd>


<dt>timestep</dt>
<dd><p>Temporal resolution of the model. Also the assumed time interval [\(T\)] 
between elements of <code>boundary.condition</code> and <code>downstream.condition</code>. 
The user is responsible for ensuring numerical stability.</p></dd>


<dt>spacestep</dt>
<dd><p>the spatial resolution of the model, interpreted as the distance [\(L\)]
between nodes in the model domain. The user is responsible for ensuring numerical stability.</p></dd>


<dt>numnodes</dt>
<dd><p>The number of nodes used to discretize the channel. The total channel extent is
computed as <code>spacestep*(numnodes - 1)</code>.</p></dd>


<dt>monitor.nodes</dt>
<dd><p>the nodes to be monitored every time step. Specified as a vector of node 
indices, with 1 being the upstream boundary and <code>numnodes</code> being the downstream boundary.</p></dd>


<dt>monitor.times</dt>
<dd><p>the time steps at which to monitor every node. Specified as a vector of 
indices of <code>boundary.condition</code>. Defaults to five equally-spaced time steps including 
the first and last time steps.</p></dd>


<dt>engine</dt>
<dd><p>The engine to be used for routing the flood wave. 
May be either "Kinematic" or "Dynamic".</p></dd>


<dt>scheme</dt>
<dd><p>Only used if <code>engine = "Dynamic"</code>. Specifies whether to use the 
Lax Diffusive scheme or the MacCormack predictor-corrector scheme.</p></dd>


<dt>boundary.type</dt>
<dd><p>Only used if <code>engine = "Dynamic"</code>. Specifies what boundary data
is supplied. Possible characters are If <code>boundary.type = "QQ"</code>, both <code>boundary.condition</code>
and <code>downstream.condition</code> are assumed to be flows [\(L^3 T^{-1}\)]. If 
<code>boundary.type = "Qy"</code> the upstream boundary is assumed to be flow
while the downstream boundary is assumed to be depth [\(L\)]. Other possibilities
are <code>"yQ"</code> and <code>"yy"</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>data.frame with columns:</p>
<dl><dt>step</dt>
<dd><p>Time step.</p></dd>

  <dt>node</dt>
<dd><p>Node index.</p></dd>

  <dt>time</dt>
<dd><p>Time since start.</p></dd>

  <dt>distance</dt>
<dd><p>Downstream distance.</p></dd>

  <dt>flow</dt>
<dd><p>Flow rate.</p></dd>

  <dt>depth</dt>
<dd><p>Flow depth.</p></dd>

  <dt>velocity</dt>
<dd><p>Flow velocity.</p></dd>

  <dt>area</dt>
<dd><p>Flow area.</p></dd>

  <dt>monitor.type</dt>
<dd><p>Row refers to a monitored node ("node") or timestep ("timestep").</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Provides implementations of a Kinematic Wave Model (KWM) and 
  a Dynamic Wave Model (DWM) with the choice of two numerical schemes. The MacCormack 
  scheme is a second-order accurate predictor-corrector scheme that provides efficient 
  flood wave routing. The Lax diffusive scheme can be used to obtain smooth solutions for
  problems with discontinuities in the boundary conditions, e.g. sudden gate closures.
  The DWM implementation uses the Method of Characteristics (MOC) to compute the flow 
  regime at the model boundaries, and allows the user to specify boundaries in terms of 
  depths and/or flows. the KWM implementation assumes the normal depth at the upstream
  boundary and is only first-order accurate.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> </span></span>
<span class="r-in"><span><span class="co"># kinematic wave routing</span></span></span>
<span class="r-in"><span><span class="va">times</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30000</span>, by <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">floodwave</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">times</span> <span class="op">&gt;=</span> <span class="fl">9000</span>, <span class="fl">250</span>,</span></span>
<span class="r-in"><span>  <span class="fl">250</span> <span class="op">+</span> <span class="op">(</span><span class="fl">750</span><span class="op">/</span><span class="va">pi</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">pi</span><span class="op">*</span><span class="va">times</span><span class="op">/</span><span class="op">(</span><span class="fl">60</span><span class="op">*</span><span class="fl">75</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">route_wave</span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.045</span>, <span class="fl">1.486</span>, <span class="fl">32.2</span>, <span class="fl">100</span>, <span class="fl">0</span>, initial.condition <span class="op">=</span> <span class="fl">250</span>, </span></span>
<span class="r-in"><span>  boundary.condition <span class="op">=</span> <span class="va">floodwave</span>, timestep <span class="op">=</span> <span class="fl">25</span>, spacestep <span class="op">=</span> <span class="fl">50</span>, </span></span>
<span class="r-in"><span>  numnodes<span class="op">=</span><span class="fl">301</span>, monitor.nodes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">101</span>, <span class="fl">201</span>, <span class="fl">301</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  monitor.times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, engine <span class="op">=</span> <span class="st">"Kinematic"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># dynamic wave routing with zero-gradient downstream condition using MacCormack scheme</span></span></span>
<span class="r-in"><span><span class="fu">route_wave</span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.045</span>, <span class="fl">1.486</span>, <span class="fl">32.2</span>, <span class="fl">100</span>, <span class="fl">0</span>, initial.condition <span class="op">=</span> <span class="fl">250</span>, </span></span>
<span class="r-in"><span>  boundary.condition <span class="op">=</span> <span class="va">floodwave</span>, downstream.condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  timestep <span class="op">=</span> <span class="fl">25</span>, spacestep <span class="op">=</span> <span class="fl">500</span>, numnodes <span class="op">=</span> <span class="fl">31</span>, engine <span class="op">=</span> <span class="st">"Dynamic"</span>, </span></span>
<span class="r-in"><span>  scheme <span class="op">=</span> <span class="st">"MacCormack"</span>, monitor.nodes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">11</span>, <span class="fl">21</span>, <span class="fl">31</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  monitor.times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">times</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># mixed boundary conditions (sudden gate closure) using Lax scheme</span></span></span>
<span class="r-in"><span><span class="va">lax</span> <span class="op">=</span> <span class="fu">route_wave</span><span class="op">(</span><span class="fl">0.00008</span>, <span class="fl">0.013</span>, <span class="fl">1</span>, <span class="fl">9.81</span>, <span class="fl">6.1</span>, <span class="fl">1.5</span>, </span></span>
<span class="r-in"><span>  initial.condition <span class="op">=</span> <span class="fl">126</span>, boundary.condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5.79</span>, <span class="fl">2001</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  downstream.condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2001</span><span class="op">)</span>, timestep <span class="op">=</span> <span class="fl">1</span>, spacestep <span class="op">=</span> <span class="fl">10</span>, </span></span>
<span class="r-in"><span>  numnodes <span class="op">=</span> <span class="fl">501</span>, monitor.nodes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">151</span>, <span class="fl">251</span>, <span class="fl">301</span>, <span class="fl">501</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  monitor.times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">501</span>, <span class="fl">1001</span>, <span class="fl">1501</span>, <span class="fl">2001</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  engine<span class="op">=</span><span class="st">"Dynamic"</span>, scheme<span class="op">=</span><span class="st">"Lax"</span>, boundary.type<span class="op">=</span><span class="st">"yQ"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># extract data for a monitored point</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">lax</span>, <span class="va">monitor.type</span> <span class="op">==</span> <span class="st">"node"</span>, <span class="va">node</span> <span class="op">==</span> <span class="fl">151</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Michael C Koohafkan.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

