<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Derivations used in rivr • rivr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Derivations used in rivr">
<meta property="og:description" content="rivr">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rivr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2-3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/publication-reproduction.html">Reproducing the R Journal Publication</a>
    </li>
    <li>
      <a href="../articles/quickstart.html">Quickstart with rivr</a>
    </li>
    <li>
      <a href="../articles/technical-vignette.html">Derivations used in rivr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mkoohafkan/rivr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Derivations used in rivr</h1>
                        <h4 data-toc-skip class="author">Michael
Koohafkan</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mkoohafkan/rivr/blob/HEAD/vignettes/technical-vignette.Rmd" class="external-link"><code>vignettes/technical-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>technical-vignette.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette documents the mathematical derivations for
gradually-varied and unsteady flow analysis with <code>rivr</code>. All
derivations are based on <a href="https://www.springer.com/us/book/9780387301747" title="Chaudhry, M. H. (2007). Open-channel flow. Springer Science &amp; Business Media." class="external-link">Chaudry
(2007)</a>. In Section 1, important definitions related to channel
geometry are discussed. In Section 2, basic concepts of open-channel
flow are discussed and one-dimensional shallow-water equations are
derived. In Section 3, gradually-varied flow is derived and the
standard-step method is discussed. In Section 4, the kinematic and
dynamic wave models for simulating unsteady flow are derived along with
the three discretization methods available in <code>rivr</code>.
Finally, Section 5 discusses the Method of Characteristics and its
application to boundary conditions of unsteady flow simulations.</p>
</div>
<div class="section level2">
<h2 id="section-1-channel-geometry-relations">Section 1: Channel geometry relations<a class="anchor" aria-label="anchor" href="#section-1-channel-geometry-relations"></a>
</h2>
<p><img src="channeldiagram.png" title="Cross-section of a trapezoidal channel."></p>
<p>A channel is <em>prismatic</em> if it has the same slope and
cross-section throughout its entire length. The <code>rivr</code>
package currently supports prismatic trapezoidal channels of arbitrary
bottom width <span class="math inline">\(B\)</span> and side slope <span class="math inline">\(SS = H:V\)</span>. Given a flow depth <span class="math inline">\(y\)</span>, the flow area is then <span class="math display">\[
A = By + SSy^2
\]</span> Another important definition is the wetted perimeter <span class="math inline">\(P\)</span>, which for a trapezoidal cross-section
is <span class="math display">\[
P = B + 2y\sqrt{1 + SS^2}
\]</span> The hydraulic radius is the ratio of the cross-sectional flow
area to the wetted perimeter, i.e. <span class="math display">\[
R = \frac{A}{P}
\]</span> The hydraulic depth <span class="math inline">\(D\)</span> is
defined as the ratio of the cross-sectional flow area to the top width
<span class="math inline">\(T\)</span>, where <span class="math display">\[
T = \frac{dA}{dy}
\]</span> which for a trapezoidal cross-section yields <span class="math display">\[
T = B + 2ySS
\]</span> and <span class="math display">\[
D = \frac{A}{T} = \frac{By + SSy^2}{B + 2ySS}
\]</span> Finally, the term <span class="math inline">\(\bar{y}\)</span>
is related to hydrostatic pressure and is defined as the distance from
the water surface to the centroid of the cross-sectional flow area, i.e.
<span class="math display">\[
\bar{y} = \frac{2B + T}{3(B + T)} y
\]</span></p>
<p>The definitions described above are fundamental properties related to
one-dimensional open-channel flow. These relations (and their
derivatives) are used extensively in the following sections to derive
important flow relations and appear repeatedly in numerical solution
schemes.</p>
</div>
<div class="section level2">
<h2 id="section-2-basic-concepts-of-one-dimensional-open-channel-flow">Section 2: Basic concepts of one-dimensional open-channel flow<a class="anchor" aria-label="anchor" href="#section-2-basic-concepts-of-one-dimensional-open-channel-flow"></a>
</h2>
<p>The flow depth of a channel in an equilibrium state is called the
<em>normal depth</em>, i.e. the flow depth at which gravitational forces
(bed slope) are balanced by friction forces (bed roughness). The
<code>rivr</code> package expresses the normal depth via the
semi-empirical Manning’s equation <span class="math display">\[
Q = \frac{C_m}{n} AR^{2/3}S_0^{1 / 2}
\]</span> where <span class="math inline">\(Q\)</span> is the channel
flow, <span class="math inline">\(S_0\)</span> is the channel slope,
<span class="math inline">\(A\)</span> is the cross-sectional flow area,
<span class="math inline">\(R\)</span> is the hydraulic depth and <span class="math inline">\(C_m\)</span> is a conversion factor based on the
unit system used (1.49 in US customary units and 1.0 in SI units). The
expression is often rewritten as <span class="math display">\[
Q = KS_0^{1 / 2}
\]</span> Where <span class="math inline">\(K\)</span> is the
<em>channel conveyance</em>. The normal depth <span class="math inline">\(y_n\)</span> factors into the expressions of both
<span class="math inline">\(A\)</span> and <span class="math inline">\(R\)</span> (i.e. <span class="math inline">\(K\)</span>) and the above equation cannot be
rearranged to solved explicitly for the normal depth; an implicit
(iterative) solution is needed. The univariate Netwon-Raphson method is
often used to provide efficient and precise solutions for <span class="math inline">\(y_n\)</span>. Generally, the Newton-Raphson method
is defined as <span class="math display">\[
x = x^* - \frac{f(x^*)}{\frac{df}{dx}\bigg|_{x^*}}
\]</span> where <span class="math inline">\(x\)</span> is the updated
guess for the parameter for which a solution is sought, <span class="math inline">\(x^*\)</span> is the prior guess for the parameter
value, <span class="math inline">\(f(x)\)</span> is a zero-valued
function of the parameter and <span class="math inline">\(\frac{df}{dx}\)</span> is the derivative of said
function. To apply the Newton-Raphson method here, Manning’s equation is
rewritten as <span class="math display">\[
f(y_n) = AR^{2/3} - \frac{nQ}{C_m S_0^{1 / 2}} = 0
\]</span> and its derivative is <span class="math display">\[
\frac{df}{dy_n} = \frac{5}{3}T R^{2/3} -
\frac{2}{3}R^{5/3}\frac{dP}{dy_n}
\]</span> where <span class="math inline">\(\frac{dP}{dy_n} = 2\sqrt{1 +
SS^2}\)</span>. A related concept is the <em>critical depth</em>, the
flow depth which minimizes the specific energy of the flow. The specific
energy is the sum of flow depth and velocity head, i.e. <span class="math display">\[
E = y + \frac{u^2}{2g} = \frac{1}{2g}\left(\frac{Q}{A}\right)^2
\]</span> where <span class="math inline">\(u\)</span> is the uniform
flow velocity. The critical depth is then the flow depth that satisfies
<span class="math display">\[
\frac{dE}{dy} = 0 = 1 - \frac{Q^2}{gA^3}\frac{dA}{dy} = 1 - \frac{Q^2
T}{gA^3}
\]</span> For a trapezoidal channel it can be mathematically proved that
only one critical depth exists for a given flow rate. The critical depth
can be solved using the Newton-Raphson method with <span class="math inline">\(f(y_c) = \frac{dE}{dy} = 0\)</span> and <span class="math display">\[
\frac{df}{dy_c} = \frac{3}{2}\left(AT\right)^{1 / 2} -
\frac{1}{2}\left(\frac{A}{T}\right)^{3/2}\frac{dT}{dy_c}
\]</span> where <span class="math inline">\(\frac{dT}{dy_c} =
2SS\)</span> for a trapezoidal channel. The critical depth is also the
depth at which the <em>Froude number</em> of the flow is unity; the
Froude number is a dimensionless measure of bulk flow characteristics
that represents the relative importance of inertial forces and
gravitational forces and is defined as <span class="math display">\[
Fr = \frac{Q}{A\sqrt{gD}}
\]</span></p>
<p>Flows are referred to as <em>subcritical</em> if the flow depth is
greater than the critical depth (<span class="math inline">\(Fr &lt;
1\)</span>) and <em>supercritical</em> if the flow depth is less than
the critical depth (<span class="math inline">\(Fr &gt; 1\)</span>).
Flows can transition gradually from subcritical to supercritical
conditions; when the rate of variation of flow depth is small with
respect to the longitudinal distance over which the change occurs, the
river state is referred to as <em>gradually-varied flow</em>. In
contrast, the transition from supercritical to subcritical conditions
occur abruptly in the form of a hydraulic jump and is an example of
<em>rapidly-varied flow</em>. Both gradually-varied and rapidly-varied
flows can be either steady (flow is constant through time) or unsteady
(flow rate varies with respect to time). The <code>rivr</code> package
provides solutions for steady gradually-varied and unsteady flow
problems.</p>
</div>
<div class="section level2">
<h2 id="section-3-solutions-to-steady-gradually-varied-flow-problems">Section 3: Solutions to steady gradually-varied flow problems<a class="anchor" aria-label="anchor" href="#section-3-solutions-to-steady-gradually-varied-flow-problems"></a>
</h2>
<p>The <em>standard-step method</em> can be used to solve the steady
gradually-varied flow profile when the channel flow and geometry are
known. Additionally, the flow depth <span class="math inline">\(y\)</span> must be known at a specified channel
cross-section; this cross-section is referred to as the <em>control
section</em> and the flow depth associated with the channel flow rate
<span class="math inline">\(Q\)</span> at the control section is <span class="math inline">\(y_1\)</span>. The total head <span class="math inline">\(H_1\)</span> at the control section is the sum of
the elevation head, flow depth head, and velocity head, i.e. <span class="math display">\[
H_1 = y_1 + z_1 + \frac{1}{2g}\left(\frac{Q}{A_1}\right)^2 = z_1 + E_1
\]</span> where <span class="math inline">\(z_1\)</span> is the
elevation of the control section bottom relative to some datum and <span class="math inline">\(A_1\)</span> is the cross-sectional flow area at
the control section. From conservation of energy, it follows that the
total head <span class="math inline">\(H_2\)</span> at some downstream
cross-section, referred to as the <em>target section</em>, is <span class="math display">\[
H_2 = H_1 - h_f
\]</span> where <span class="math inline">\(h_f\)</span> is the head
loss. While the head loss term generally combines both friction loss and
form drag, the latter component is neglected by <code>rivr</code>. The
friction component is expressed as the average friction slope between
the control and target sections: <span class="math display">\[
h_f = \frac{{S_f}_1 + {S_f}_2}{2} \left(x_2 - x_1\right)
\]</span> where <span class="math inline">\(x_2 - x_1\)</span> is the
longitudinal distance between the control and target section. Note that
the sign of <span class="math inline">\(h_f\)</span> therefore depends
on whether the control section is upstream (<span class="math inline">\(x_1 &lt; x_2\)</span>) or downstream (<span class="math inline">\(x_1 &gt; x_2\)</span>) of the target section.
Substituting these terms into the governing equation and rearranging
yields <span class="math display">\[
y_2 + z_2 + \frac{1}{2g}\left(\frac{Q}{A_2}\right)^2 + \frac{{S_f}_1 +
{S_f}_2}{2} \left(x_2 - x_1\right) = y_1 + z_1 +
\frac{1}{2g}\left(\frac{Q}{A_1}\right)^2
\]</span> Note that all terms on the right-hand side of the equation are
known, while <span class="math inline">\(A_2\)</span> and <span class="math inline">\({S_f}_2\)</span> on the left-hand side of the
equation are functions of <span class="math inline">\(y_2\)</span>.
Transposing all terms to the left-hand side yields a zero-value function
of <span class="math inline">\(y_2\)</span>: <span class="math display">\[
f(y_2) = 0 = y_2 + z_2 + \frac{1}{2g}\left(\frac{Q}{A_2}\right)^2 +
\frac{{S_f}_1 + {S_f}_2}{2} \left(x_2 - x_1\right) - y_1 - z_1 -
\frac{1}{2g}\left(\frac{Q}{A_1}\right)^2
\]</span> This function is suitable for solving using the Newton-Raphson
method discussed previously, i.e. <span class="math display">\[
y_2 = y_2^* - \frac{f(y_2^*)}{\frac{df}{dy}\bigg|_{y_2^*}}
\]</span> where <span class="math display">\[
\frac{df}{dy_2} = 1 - \frac{Q^2}{gA_2^3}\frac{dA_2}{dy_2} +
\frac{1}{2}\left(x_2 - x_1\right) \frac{d{S_f}_2}{dy_2}
\]</span> and <span class="math display">\[
\frac{d{S_f}_2}{dy} = -2\left(\frac{{S_f}_2}{A} \frac{dA}{dy} +
\frac{2}{3} \frac{{S_f}_2}{R} \frac{dR}{dy} \right)
\]</span> Once the flow depth at the target section is found, the target
section becomes the new control section and the flow depth at the next
target section is computed, with the algorithm “stepping” up or down the
channel to a specified distance from the initial control section. The
standard-step method is accessed via the function
<code>compute_profile</code>.</p>
</div>
<div class="section level2">
<h2 id="section-4-solutions-to-unsteady-flow-problems">Section 4: Solutions to unsteady-flow problems<a class="anchor" aria-label="anchor" href="#section-4-solutions-to-unsteady-flow-problems"></a>
</h2>
<p>Unsteady flow problems are generally characterized using the Shallow
Water Equations, with the one-dimensional form expressed as <span class="math display">\[
\frac{\partial A}{\partial t} + \frac{\partial Q}{\partial x} = 0
\]</span> <span class="math display">\[
\frac{\partial Q}{\partial t} + \frac{\partial}{\partial x} \left(Qu +
g\bar{y}A\right) - gA\left(S_0 - S_f\right) = 0
\]</span> where the first equation expresses mass conservation and the
second expresses momentum conservation. Without further simplification,
these equations are often referred to as the Dynamic Wave Model (DWM).
The Kinematic Wave Model (KWM) refers to a simplification of the
momentum equation by assuming <span class="math inline">\(S_0 =
S_f\)</span>, i.e. the momentum equation is instead expressed through
the relation <span class="math display">\[
A = \left( \frac{nQP^{2/3}}{C_m S_0^{1 / 2}} \right)^{3/5}
\]</span> Both the KWM and DWM can be solved using numerical
discretization methods such as finite-difference schemes.
Finite-difference schemes discretize a continuous model domain into a
series of <em>nodes</em> separated by an incremental distance <span class="math inline">\(\Delta x\)</span>. The model time domain is
similarly discretized into a series of time steps separated by an
incremental time <span class="math inline">\(\Delta t\)</span>. A
finite-difference scheme is called <em>explicit</em> if the value of the
variable being solved for on time step <span class="math inline">\(k +
1\)</span> depends explicitly on the value of the variable at the
previous time step <span class="math inline">\(k\)</span>. Explicit
methods are advantageous because they are easier to program and
implement, but are disadvantageous because they are subject to stability
constraints. The stability constraint is defined by the Courant number
<span class="math display">\[
C = \frac{\Delta t}{\Delta x} u
\]</span> which represents the ratio of the flow velocity to the rate of
propagation of information through the model domain. The numerical
solution is unstable if <span class="math inline">\(C &gt;
1\)</span>.</p>
<p>The <code>rivr</code> package provides an interface to one
finite-difference numerical scheme for the KWM and two finite-difference
schemes for the DWM. In addition, the DWM interface supports boundary
condition solutions using the Method of Characteristics (MOC). These
schemes are accessed via the function <code>route_wave</code> and their
derivations are discussed below.</p>
<div class="section level3">
<h3 id="solution-to-the-kinematic-wave-model">Solution to the Kinematic Wave Model<a class="anchor" aria-label="anchor" href="#solution-to-the-kinematic-wave-model"></a>
</h3>
<p>The KWM finite-difference scheme implemented in <code>rivr</code>
requires a constant time step and spatial resolution, a known upstream
boundary condition (flow) for the full simulation time, and an initial
condition (flow) at every node. The initial water depth, flow area, and
flow velocity are calculated from the channel geometry relations, with
the initial water depth assumed to be the normal depth. At the
initiation of a new time step <span class="math inline">\(k +
1\)</span>, the flow at the upstream boundary node <span class="math inline">\(i = 1\)</span> is assigned from the user-supplied
boundary condition. The flow depth at the upstream boundary is
calculated as the normal depth for that flow, i.e. <span class="math display">\[
y_1^{k+1} = y_n\left(Q_1^{k+1}\right)
\]</span> where the superscripts denote the timestep. The flow at a
downstream node <span class="math inline">\(i\)</span> is computed as
<span class="math display">\[
Q_i^{k+1} = Q^{k+1}_{i - 1} - \frac{\Delta x}{\Delta t}\left(
A_{i-1}^{k+1} - A_{i-1}^{k}\right)
\]</span> where the subscripts denote the node. The flow depth at node
<span class="math inline">\(i\)</span> is calculated using a
Newton-Raphson formulation where <span class="math display">\[
f(y_i^{k+1}) = 0 = A_i^{k+1} - \left(\frac{nQ_i^{k+1}}{C_m S_0^{1 /
2}}\right)^{3/5} \left(P_i^{k+1}\right)^{2/5}
\]</span><br>
and <span class="math display">\[
\frac{df}{dy_i^{k+1}} = \frac{dA}{dy}\bigg|_{y_i^{k+1}} -
\frac{2}{5}\frac{dP}{dy}\bigg|_{y_i^{k+1}} \left( \frac{nQ_i^{k+1}}{C_m
S_0^{1 / 2} P_i^{k+1}} \right)^{3/5}
\]</span> Once the flow depth is known, the remaining geometry relations
can be computed and the algorithm moves to the next downstream node. The
algorithm advances to the next time step once all nodes are
computed.</p>
</div>
<div class="section level3">
<h3 id="solution-to-the-dynamic-wave-model-the-lax-diffusive-scheme">Solution to the Dynamic Wave Model: the Lax diffusive scheme<a class="anchor" aria-label="anchor" href="#solution-to-the-dynamic-wave-model-the-lax-diffusive-scheme"></a>
</h3>
<p>The set of equations describing the DWM are more complex than the
KWM, and therefore requires more sophisticated numerical solution
methods. The Lax diffusive scheme is similar to the scheme used for the
KWM in terms of the model domain discretization and initialization, but
requires additional computations at each node to obtain the
solution.</p>
<p>For an internal (non-boundary) node <span class="math inline">\(i\)</span> on time step <span class="math inline">\(k + 1\)</span>, flow values are computed through a
two step process. First, averages of <span class="math inline">\(A\)</span>, <span class="math inline">\(Q\)</span>, and the inertial term <span class="math inline">\(S = gA\left(S_f - S_0\right)\)</span> are computed
for the node, i.e. <span class="math display">\[
A_i^* = \frac{1}{2}\left(A^k_{i+1} + A^k_{i - 1}  \right)
\]</span> <span class="math display">\[
Q^*_i = \frac{1}{2}\left(Q^k_{i+1} + Q^k_{i - 1}  \right)
\]</span> <span class="math display">\[
S_i^* = \frac{1}{2}\left(S^k_{i+1} + S^k_{i - 1}\right) =
\frac{gA}{2}\left({S_f}^k_{i + 1}  + {S_f}^k_{i - 1} - 2S_0\right)
\]</span> The values for node <span class="math inline">\(i\)</span> on
time step <span class="math inline">\(k + 1\)</span> are then calculated
as <span class="math display">\[
A_i^{k + 1} = A_i^* - \frac{\Delta t}{2\Delta x}\left(Q^k_{i+1} -
Q^k_{i-1}\right)
\]</span> <span class="math display">\[
Q_i^{k + 1} = Q_i^* - \frac{\Delta t}{2\Delta x}\left(F^k_{i+1} -
F^k_{i-1}\right) -  S_i^*\Delta t
\]</span> where <span class="math inline">\(F = Qu + g\bar{y}A\)</span>.
To compute the flow depth <span class="math inline">\(y_i^{k+1}\)</span>
from the new area <span class="math inline">\(A_i^{k+1}\)</span>, the
Newton-Raphson method is again applied where <span class="math display">\[
f(y_i^{k+1}) = 0 = A\left(y_i^{k+1}\right) - A_i^{k+1}
\]</span> and <span class="math display">\[
\frac{df}{dy_i^{k+1}} = \frac{dA}{dy} \bigg|_{y_i^{k+1}}
\]</span> It is clear from the derivation that unlike the KWM solution,
both the upstream and the downstream boundary conditions must be known
at each time step. The MOC described later provides a method for
predicting, rather than imposing, the downstream boundary condition.</p>
</div>
<div class="section level3">
<h3 id="solution-to-the-dynamic-wave-model-the-maccormack-scheme">Solution to the Dynamic Wave Model: the MacCormack scheme<a class="anchor" aria-label="anchor" href="#solution-to-the-dynamic-wave-model-the-maccormack-scheme"></a>
</h3>
<p>The MacCormack scheme is an advanced finite-differencing scheme that
provides high accuracy for considerably coarser spatial and temporal
resolutions compared to the Lax diffusive scheme. The scheme consists of
a backwards-looking predictor step followed by a forward-looking
corrector step. The intermediate values calculated in the predictor step
are used to develop new intermediate values in the corrector step, and
these calculations are averaged to obtain the final value. The predictor
step computes the intermediate values at an internal node <span class="math inline">\(i\)</span> as <span class="math display">\[
Q_i^* = Q_i^k - \frac{\Delta t}{\Delta x}\left( F_i - F_{i - 1}\right) -
S_i^k \Delta t
\]</span> <span class="math display">\[
A^*_i = A_i^k - \frac{\Delta t}{\Delta x}\left( Q_i^k - Q_{i-1}^k
\right)
\]</span> with intermediate values of <span class="math inline">\(F\)</span> and <span class="math inline">\(S\)</span> (<span class="math inline">\(F^*\)</span> and <span class="math inline">\(S^*\)</span>) computed from these results. On the
corrector step, new values for <span class="math inline">\(Q\)</span>
and <span class="math inline">\(A\)</span> are computed as <span class="math display">\[
Q_i^{**} = Q_i^{k} - \frac{\Delta t}{\Delta x}\left( F^*_{i + 1} -
F^*_{i} \right) - S_i^* \Delta t
\]</span> <span class="math display">\[
A_i^{**} = A_i^k - \frac{\Delta t}{\Delta x}\left( Q_{i+1}^* - Q_i^*
\right)
\]</span> The new values for time step <span class="math inline">\(k +
1\)</span> are the arithmetic averages of the predictor and corrector
step results, i.e. <span class="math inline">\(Q_i^{k+1} =
\frac{1}{2}\left( Q_i^* + Q_i^{**} \right)\)</span> and <span class="math inline">\(A_i^{k+1} = \frac{1}{2}\left( A_i^* + A_i^{**}
\right)\)</span>. The remaining terms are then computed from these new
values.</p>
</div>
<div class="section level3">
<h3 id="solutions-to-boundary-conditions-the-method-of-characteristics">Solutions to boundary conditions: the Method of Characteristics<a class="anchor" aria-label="anchor" href="#solutions-to-boundary-conditions-the-method-of-characteristics"></a>
</h3>
<p>The DWM solution schemes provided by <code>rivr</code> require that
both the upstream and downstream boundary be known. Because the
downstream boundary is not known <em>a priori</em> under many
circumstances, the requirement would limit the utility of the numerical
schemes. The Method of Characteristics (MOC) provides a method for
predicting the downstream boundary condition at the beginning of each
time step, allowing users to route waves trhough the downstream boundary
with minimal loss of information. In addition, the method also allows
the user to specify both the upstream and downstream boundary conditions
in terms of either flow or depth, and allows specification of sudden
cessation of flow, i.e. closure of a sluice gate at the upstream or
downstream boundary.</p>
<p>MOC is a well-known concept with application to a wide variety of
numerical problems; the general theory is not presented here. It can be
shown that the upstream boundary condition (node <span class="math inline">\(i = 1\)</span>) on time step <span class="math inline">\(k\)</span> can be defined as <span class="math display">\[
u_1^k = \phi_1^0 + \psi_2^0 y_1^k
\]</span> where <span class="math display">\[
\psi_2^0 = \sqrt{\frac{g}{y_2^0}}
\]</span> and <span class="math display">\[
\phi_1^0 = u_2^0 - \psi_2^0 + g\left( S_0 - {S_f}_2^0 \right)\Delta t
\]</span> As seen from these relations, the flow velocity and depth at
the upstream boundary on any time step <span class="math inline">\(k\)</span> are related to the initial conditions
(i.e.  <span class="math inline">\(k = 0\)</span>). The downstream
boundary condition (node <span class="math inline">\(i = N\)</span>) is
similarly expressed as <span class="math display">\[
u^k_N = \phi_N^0 - \psi_{N-1}^0 y_N^k
\]</span> where <span class="math display">\[
\psi^0_{N-1} = \sqrt{\frac{g}{y^0_{N-1}}}
\]</span> and <span class="math display">\[
\phi^0_{N} = u^0_{N-1} + \psi^0_{N-1} y^0_{N-1} + g\left( S_0 -
{S_f}^0_{N-1} \right) \Delta t
\]</span> Therefore given either a flow or depth on timestep <span class="math inline">\(k\)</span>, the upstream boundary condition can be
computed as long as the initial conditions are known. This is a notable
improvement over the normal-depth assumption of the upstream boundary
condition employed in the KWM. Flow can be routed through the downstream
boundary by assuming the gradient in flow or water level between the
downstream boundary and the nearest internal node is zero (i.e. <span class="math inline">\(Q^k_N = Q^k_{N-1}\)</span> or <span class="math inline">\(y^k_N = y^k_{N-1}\)</span>). This results in
“smearing” the solution across the downstream boundary but is often
still preferable to direct specification of flow. Specifying the
downstream boundary as a constant water depth representing i.e. a lake
or reservoir water level may also be appropriate under many
circumstances. When flow is specified at e.g. the upstream boundary,
flow depth and area are solved simultaneously using a Newton-Raphson
scheme where <span class="math display">\[
f(y_1^k) = Q_1^k - A_1^k \left(\phi_1^0 + \psi_2^0 y_1^k\right) = 0
\]</span> and <span class="math display">\[
\frac{df}{dy_1^k} = -\frac{dA}{dy}\bigg|_{y_1^k} \left( \phi_1^0 +
\psi_2^0 A_1^k + y_1^k \right)
\]</span> Note that if <span class="math inline">\(Q_1^k = 0\)</span>
the flow depth <span class="math inline">\(y_1^k\)</span> can be solved
for directly, and if depth is supplied then the flow can be solved for
directly. The solution method for the downstream boundary is analogous,
noting that the sign of the second term in <span class="math inline">\(f(y^k_{N})\)</span> and the corresponding term in
its derivative are reversed.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael C Koohafkan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
